<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Farcaster Punks — Mint</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <!-- ✅ Miniapp Embed Tag -->
  <meta name="fc:miniapp" content='{
    "version": "next",
    "imageUrl": "https://chocolate-major-guan-717.mypinata.cloud/ipfs/bafybeiafbdvvk4u66oe22sv2onpiznlwulgpnmdixxh4bhb62xsrw6ms6e",
    "button": {
      "title": "Mint Now",
      "action": {
        "type": "launch_miniapp",
        "name": "Farcaster Punks — Mint",
        "url": "https://mint-farcaster-punks.vercel.app/"
      }
    }
  }' />

  <style>
    body{background:#0b0720;color:#fff;font-family:Inter,ui-sans-serif;padding:24px;display:flex;justify-content:center;align-items:center;min-height:100vh}
    .card{max-width:720px;width:100%;background:rgba(255,255,255,0.03);padding:28px;border-radius:12px;text-align:center}
    button{background:#7c3aed;border:none;color:#fff;padding:12px 18px;border-radius:8px;cursor:pointer}
    .muted{color:#b9b6cb}
    .row{display:flex;gap:16px;justify-content:center;margin-top:18px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.min.js"></script>
</head>
<body>
  <div class="card">
    <img src="https://chocolate-major-guan-717.mypinata.cloud/ipfs/bafybeiafbdvvk4u66oe22sv2onpiznlwulgpnmdixxh4bhb62xsrw6ms6e" alt="logo" style="width:160px;border-radius:12px"/>
    <h1>Farcaster Punks — Official Mint</h1>
    <p class="muted">Mint directly in Warpcast — open & press Mint Now</p>

    <div id="status" class="muted">Not connected</div>

    <div class="row">
      <button id="connectBtn">Connect Wallet</button>
      <button id="mintBtn" disabled>Mint Now</button>
    </div>

    <p class="muted" style="margin-top:18px">Once connected, press Mint Now to submit transaction using your wallet.</p>
  </div>

<script>
const SEADROP_ADDRESS = "0x00005EA00Ac477B1030CE78506496e8C2dE24bf5"; // contoh SeaDrop
const NFT_CONTRACT = "0x4d749dc4016936759e437b1a01d2ef0f0690e651"; // ganti kontrakmu
const SEADROP_ABI = [
  "function getPublicDrop(address nftContract) external view returns (uint80 mintPrice, uint48 startTime, uint48 endTime, uint16 maxTotalMintableByWallet, uint16 feeBps, bool restrictFeeRecipients)",
  "function mintPublic(address nftContract, address feeRecipient, address minterIfNotPayer, uint256 quantity) external payable"
];

let provider, signer, userAddress;
const statusEl = document.getElementById('status');
const connectBtn = document.getElementById('connectBtn');
const mintBtn = document.getElementById('mintBtn');

async function connect() {
  if (window.ethereum) {
    provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = await provider.getSigner();
    userAddress = await signer.getAddress();
    statusEl.innerText = "Connected: " + userAddress;
    connectBtn.innerText = 'Connected';
    mintBtn.disabled = false;
  } else {
    alert('No injected wallet found. Use Warpcast in-app or install MetaMask / WalletConnect.');
  }
}

async function mint() {
  try {
    mintBtn.disabled = true;
    statusEl.innerText = "Preparing mint...";

    const seadrop = new ethers.Contract(SEADROP_ADDRESS, SEADROP_ABI, provider);
    const publicDrop = await seadrop.getPublicDrop(NFT_CONTRACT);
    const mintPrice = BigInt(publicDrop[0].toString ? publicDrop[0].toString() : publicDrop[0]);
    const qty = 1n;
    const total = mintPrice * qty;

    const seadropWithSigner = new ethers.Contract(SEADROP_ADDRESS, SEADROP_ABI, signer);
    const tx = await seadropWithSigner.mintPublic(NFT_CONTRACT, ethers.ZeroAddress, userAddress, Number(qty), { value: total });
    statusEl.innerText = "Tx sent: " + tx.hash;
    await tx.wait();
    statusEl.innerText = "Mint complete: " + tx.hash;
  } catch (e) {
    console.error(e);
    statusEl.innerText = "Mint error: " + (e?.message || e);
  } finally {
    mintBtn.disabled = false;
  }
}

connectBtn.onclick = connect;
mintBtn.onclick = mint;
</script>
</body>
</html>
