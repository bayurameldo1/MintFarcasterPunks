<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Farcaster Punks — Mint</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <!-- Farcaster MiniApp Embed Tag -->
  <meta name="fc:miniapp" content='{
    "version": "next",
    "imageUrl": "https://chocolate-major-guan-717.mypinata.cloud/ipfs/bafybeiafbdvvk4u66oe22sv2onpiznlwulgpnmdixxh4bhb62xsrw6ms6e",
    "button": {
      "title": "Mint on OpenSea",
      "action": {
        "type": "launch_miniapp",
        "name": "Farcaster Punks — Mint",
        "url": "https://mint-farcaster-punks.vercel.app/"
      }
    }
  }' />

  <!-- Open Graph & Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Farcaster Punks — Mint Status" />
  <meta property="og:description" content="Live minted count & link to mint on OpenSea." />
  <meta property="og:image" content="https://chocolate-major-guan-717.mypinata.cloud/ipfs/bafybeiafbdvvk4u66oe22sv2onpiznlwulgpnmdixxh4bhb62xsrw6ms6e" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root{--bg:#0b0720;--card:rgba(255,255,255,0.03);--muted:#b9b6cb;--accent:#7c3aed}
    html,body{height:100%;margin:0}
    body{background:var(--bg);color:#fff;font-family:Inter,system-ui,Arial;padding:20px;display:flex;align-items:center;justify-content:center}
    .card{max-width:720px;width:100%;background:var(--card);padding:24px;border-radius:12px;text-align:center}
    .logo{width:120px;height:120px;border-radius:12px;object-fit:cover;display:block;margin:0 auto 12px}
    h1{margin:8px 0 4px;font-size:20px}
    .muted{color:var(--muted);margin:0 0 8px}
    .status{font-size:18px;margin:10px 0;font-weight:600}
    .btn{display:inline-block;padding:12px 18px;border-radius:10px;background:var(--accent);color:#fff;text-decoration:none;font-weight:700;margin-top:10px}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
  </style>

  <!-- ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.min.js"></script>
</head>
<body>
  <main class="card" role="main">
    <img class="logo" src="https://chocolate-major-guan-717.mypinata.cloud/ipfs/bafybeiafbdvvk4u66oe22sv2onpiznlwulgpnmdixxh4bhb62xsrw6ms6e" alt="logo" />
    <h1>Farcaster Punks — Mint</h1>
    <p class="muted">Live minted count (auto updates)</p>

    <div class="status" id="mintStatus">Loading...</div>
    <p class="muted" id="supplyInfo">Supply: 2,222</p>

    <a class="btn" id="openSeaBtn" href="https://opensea.io/collection/farcaster-punks-59466883/overview" target="_blank" rel="noreferrer">
      Mint on OpenSea
    </a>

    <footer>© 2025 Farcaster Punks — MiniApp Embed</footer>
  </main>

<script>
const SUPPLY = 2222;
const NFT_CONTRACT = "0x4d749dc4016936759e437b1a01d2ef0f0690e651"; // your contract
const RPC_URL = "https://mainnet.base.org"; // Base mainnet RPC
const ABI = ["function totalSupply() view returns (uint256)"];
const POLL_INTERVAL_MS = 15000;

const mintStatusEl = document.getElementById("mintStatus");
const supplyInfoEl = document.getElementById("supplyInfo");

async function fetchMinted() {
  try {
    const provider = new ethers.JsonRpcProvider(RPC_URL);
    const contract = new ethers.Contract(NFT_CONTRACT, ABI, provider);
    const total = await contract.totalSupply();
    const minted = Number(total.toString());
    mintStatusEl.textContent = `${minted} / ${SUPPLY} minted`;
    if (minted >= SUPPLY) mintStatusEl.style.color = "#ff6b6b";
  } catch (err) {
    mintStatusEl.textContent = "Unable to fetch data";
    console.error(err);
  }
}

fetchMinted();
setInterval(fetchMinted, POLL_INTERVAL_MS);
</script>
</body>
</html>
